<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ªòÁÆã Todo „Ç¢„Éó„É™</title>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/7.4.47/css/materialdesignicons.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Kalam', cursive;
            background: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
            background-image: 
                radial-gradient(circle, #ddd 1px, transparent 1px),
                linear-gradient(90deg, #f0f0f0 1px, transparent 1px),
                linear-gradient(180deg, #f0f0f0 1px, transparent 1px);
            background-size: 20px 20px, 40px 40px, 40px 40px;
            user-select: none;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .header-menu {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-button {
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            position: relative;
        }

        .menu-button:hover {
            background: #1976D2;
        }

        .menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            z-index: 1001;
            display: none;
            margin-top: 5px;
        }

        .menu-dropdown.show {
            display: block;
        }

        .menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item:first-child {
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        .menu-item:last-child {
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .menu-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .workspace {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 80px;
            overflow: hidden;
        }

        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            z-index: 1000;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .picker-group {
            display: flex;
            gap: 10px;
        }

        .picker {
            position: relative;
        }

        .picker-btn {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .picker-btn:hover {
            border-color: #999;
        }

        .dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
            z-index: 1001;
            min-width: 120px;
        }

        .dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dropdown-item:hover {
            background: #f5f5f5;
        }

        .size-indicator {
            width: 16px;
            height: 16px;
            background: #ddd;
            border-radius: 2px;
        }

        .size-indicator.small { width: 12px; height: 12px; }
        .size-indicator.medium { width: 16px; height: 16px; }
        .size-indicator.large { width: 20px; height: 20px; }

        .color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid #ddd;
        }

        .todo-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Kalam', cursive;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .todo-input:focus {
            border-color: #2196F3;
        }

        .add-btn {
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: #1976D2;
        }

        .sticky-note {
            position: absolute;
            width: 200px;
            height: 180px;
            background: #ffeb3b;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: move;
            transform: rotate(-1deg);
            transition: transform 0.3s, box-shadow 0.3s;
            z-index: 1;
        }

        .sticky-note.small {
            width: 150px;
            height: 150px;
        }

        .sticky-note.medium {
            width: 200px;
            height: 180px;
        }

        .sticky-note.large {
            width: 250px;
            height: 220px;
        }

        .sticky-note.yellow { background: #ffeb3b; }
        .sticky-note.pink { background: #f8bbd9; }
        .sticky-note.blue { background: #90caf9; }
        .sticky-note.green { background: #a5d6a7; }
        .sticky-note.orange { background: #ffcc80; }
        .sticky-note.purple { background: #ce93d8; }

        .sticky-note:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .sticky-note.dragging {
            transform: rotate(0deg) scale(1.1);
            box-shadow: 0 12px 24px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .sticky-note.focused {
            border: 2px solid #2196F3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.3);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .note-actions {
            display: flex;
            gap: 5px;
        }

        .note-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 2px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .note-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .note-content {
            padding: 8px;
            height: calc(100% - 40px);
            resize: none;
            border: none;
            background: transparent;
            font-family: 'Kalam', cursive;
            font-size: 14px;
            width: 100%;
            outline: none;
        }

        .note-date {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            color: rgba(0,0,0,0.5);
        }

        .color-picker {
            position: absolute;
            top: 30px;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            display: none;
            z-index: 1001;
        }

        .color-picker.show {
            display: block;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            margin: 2px;
            display: inline-block;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .color-option:hover {
            border-color: #333;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .file-input {
            display: none;
        }

        .help-content {
            text-align: left;
            line-height: 1.6;
        }

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h3 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .switch.on {
            background: #2196F3;
        }

        .switch-thumb {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .switch.on .switch-thumb {
            transform: translateX(26px);
        }

        @media (max-width: 768px) {
            .input-container {
                flex-direction: column;
            }
            
            .picker-group {
                width: 100%;
                justify-content: center;
            }
            
            .header-menu {
                gap: 5px;
            }
            
            .menu-button {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .menu-dropdown {
                right: 0;
                min-width: 180px;
            }
        }

        @keyframes deleteAnimation {
            0% {
                transform: rotate(-1deg) scale(1);
                opacity: 1;
            }
            50% {
                transform: rotate(-180deg) scale(0.5);
                opacity: 0.5;
            }
            100% {
                transform: rotate(-360deg) scale(0);
                opacity: 0;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥1: 720Â∫¶ÂõûËª¢ËêΩ‰∏ã */
        @keyframes spinFallAnimation {
            0% {
                transform: rotate(var(--initial-rotation, -1deg)) translateY(0);
                opacity: 1;
            }
            20% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 144deg)) translateY(100px);
                opacity: 1;
            }
            100% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 720deg)) translateY(calc(100vh + 300px));
                opacity: 0;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥2: ÊôÆÈÄö„Å´ËêΩ‰∏ã */
        @keyframes normalFallAnimation {
            0% {
                transform: rotate(var(--initial-rotation, -1deg)) translateY(0) translateX(0);
                opacity: 1;
            }
            10% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 5deg)) translateY(50px) translateX(10px);
                opacity: 1;
            }
            30% {
                transform: rotate(calc(var(--initial-rotation, -1deg) - 3deg)) translateY(200px) translateX(-5px);
                opacity: 0.9;
            }
            60% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 8deg)) translateY(500px) translateX(15px);
                opacity: 0.6;
            }
            100% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 15deg)) translateY(calc(100vh + 200px)) translateX(25px);
                opacity: 0;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥3: „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà */
        @keyframes fadeOutAnimation {
            0% {
                transform: rotate(var(--initial-rotation, -1deg)) scale(1);
                opacity: 1;
            }
            50% {
                transform: rotate(var(--initial-rotation, -1deg)) scale(0.8);
                opacity: 0.5;
            }
            100% {
                transform: rotate(var(--initial-rotation, -1deg)) scale(0.6);
                opacity: 0;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥4: „Ç¥„ÉüÁÆ±„Å´Âê∏„ÅÑËæº„Åæ„Çå„Çã */
        @keyframes trashSuckAnimation {
            0% {
                transform: rotate(var(--initial-rotation, -1deg)) scale(1) translate(0, 0);
                opacity: 1;
            }
            50% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 90deg)) scale(0.7) translate(calc(var(--trash-x, 0px) * 0.5), calc(var(--trash-y, 0px) * 0.5));
                opacity: 0.8;
            }
            90% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 270deg)) scale(0.2) translate(var(--trash-x, 0px), var(--trash-y, 0px));
                opacity: 0.3;
            }
            100% {
                transform: rotate(calc(var(--initial-rotation, -1deg) + 360deg)) scale(0) translate(var(--trash-x, 0px), var(--trash-y, 0px));
                opacity: 0;
            }
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥5: Ë∂≥„ÅåÁîü„Åà„Å¶ÈÄÉ„Åí„Çã */
        @keyframes walkAwayAnimation {
            0% {
                transform: rotate(var(--initial-rotation, -1deg)) translateX(0);
                opacity: 1;
            }
            20% {
                transform: rotate(0deg) translateX(var(--walk-direction, 50px));
                opacity: 1;
            }
            100% {
                transform: rotate(0deg) translateX(calc(var(--walk-direction, 50px) * 8));
                opacity: 0;
            }
        }

        /* „Ç¥„ÉüÁÆ± */
        .trash-can {
            position: fixed;
            bottom: 50%;
            right: 20px;
            transform: translateY(50%);
            width: 80px;
            height: 80px;
            background: #666;
            border-radius: 8px 8px 16px 16px;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
            border: 3px solid #444;
        }

        .trash-can::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -8px;
            right: -8px;
            height: 10px;
            background: #666;
            border-radius: 6px;
            border: 3px solid #444;
        }

        .trash-can::after {
            content: '';
            position: absolute;
            top: -16px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 6px;
            background: #666;
            border-radius: 3px;
            border: 2px solid #444;
        }

        .trash-can.show {
            opacity: 1;
        }

        /* Ë∂≥„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .sticky-note.walking::after {
            content: 'üë£';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            opacity: 1;
            animation: walkingFeet 0.3s infinite;
        }

        @keyframes walkingFeet {
            0% {
                transform: translateX(-50%) rotate(-10deg);
            }
            50% {
                transform: translateX(-50%) rotate(10deg);
            }
            100% {
                transform: translateX(-50%) rotate(-10deg);
            }
        }

        .deleting {
            animation: deleteAnimation 0.5s ease-out;
        }

        .falling {
            z-index: 1001;
        }

        .falling.spin-fall {
            animation: spinFallAnimation 2s ease-in forwards;
        }

        .falling.normal-fall {
            animation: normalFallAnimation 1.5s ease-in forwards;
        }

        .falling.fade-out {
            animation: fadeOutAnimation 1s ease-out forwards;
        }

        .falling.trash-suck {
            animation: trashSuckAnimation 1.5s ease-in forwards;
        }

        .falling.walk-away {
            animation: walkAwayAnimation 2s ease-out forwards;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <i class="mdi mdi-note-text"></i>
            ‰ªòÁÆã Todo
        </div>
        <div class="header-menu">
            <div class="save-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">‰øùÂ≠òÊ∏à„Åø</span>
                <span id="noteCount">0ÂÄã„ÅÆ‰ªòÁÆã</span>
            </div>
            <div style="position: relative;">
                <button class="menu-button" id="menuButton">
                    <i class="mdi mdi-menu"></i>
                    <span>„É°„Éã„É•„Éº</span>
                </button>
                <div class="menu-dropdown" id="menuDropdown">
                    <div class="menu-item" id="menuAddNote">
                        <i class="mdi mdi-note-plus menu-icon"></i>
                        <span>Á©∫„ÅÆ‰ªòÁÆãËøΩÂä†</span>
                    </div>
                    <div class="menu-item" id="menuDeleteAll">
                        <i class="mdi mdi-delete-sweep menu-icon"></i>
                        <span>ÂÖ®‰ªòÁÆãÂâäÈô§</span>
                    </div>
                    <div class="menu-item" id="menuRandomize">
                        <i class="mdi mdi-shuffle-variant menu-icon"></i>
                        <span>„É©„É≥„ÉÄ„É†ÈÖçÁΩÆ</span>
                    </div>
                    <div class="menu-item" id="menuSave">
                        <i class="mdi mdi-content-save menu-icon"></i>
                        <span>ÊâãÂãï‰øùÂ≠ò</span>
                    </div>
                    <div class="menu-item" id="menuExport">
                        <i class="mdi mdi-export menu-icon"></i>
                        <span>„Ç®„ÇØ„Çπ„Éù„Éº„Éà</span>
                    </div>
                    <div class="menu-item" id="menuImport">
                        <i class="mdi mdi-import menu-icon"></i>
                        <span>„Ç§„É≥„Éù„Éº„Éà</span>
                    </div>
                    <div class="menu-item" id="menuSettings">
                        <i class="mdi mdi-cog menu-icon"></i>
                        <span>Ë®≠ÂÆö</span>
                    </div>
                    <div class="menu-item" id="menuHelp">
                        <i class="mdi mdi-help-circle menu-icon"></i>
                        <span>„Éò„É´„Éó</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="workspace" id="workspace"></div>

    <div class="controls">
        <div class="input-container">
            <div class="picker-group">
                <div class="picker">
                    <div class="picker-btn" id="sizePicker">
                        <div class="size-indicator medium"></div>
                        <span>‰∏≠</span>
                    </div>
                    <div class="dropdown" id="sizeDropdown">
                        <div class="dropdown-item" data-size="small">
                            <div class="size-indicator small"></div>
                            <span>Â∞è</span>
                        </div>
                        <div class="dropdown-item" data-size="medium">
                            <div class="size-indicator medium"></div>
                            <span>‰∏≠</span>
                        </div>
                        <div class="dropdown-item" data-size="large">
                            <div class="size-indicator large"></div>
                            <span>Â§ß</span>
                        </div>
                    </div>
                </div>
                <div class="picker">
                    <div class="picker-btn" id="colorPicker">
                        <div class="color-dot" style="background: #ffeb3b;"></div>
                        <span>ÈªÑ</span>
                    </div>
                    <div class="dropdown" id="colorDropdown">
                        <div class="dropdown-item" data-color="yellow">
                            <div class="color-dot" style="background: #ffeb3b;"></div>
                            <span>ÈªÑ</span>
                        </div>
                        <div class="dropdown-item" data-color="pink">
                            <div class="color-dot" style="background: #f8bbd9;"></div>
                            <span>„Éî„É≥„ÇØ</span>
                        </div>
                        <div class="dropdown-item" data-color="blue">
                            <div class="color-dot" style="background: #90caf9;"></div>
                            <span>Èùí</span>
                        </div>
                        <div class="dropdown-item" data-color="green">
                            <div class="color-dot" style="background: #a5d6a7;"></div>
                            <span>Á∑ë</span>
                        </div>
                        <div class="dropdown-item" data-color="orange">
                            <div class="color-dot" style="background: #ffcc80;"></div>
                            <span>„Ç™„É¨„É≥„Ç∏</span>
                        </div>
                        <div class="dropdown-item" data-color="purple">
                            <div class="color-dot" style="background: #ce93d8;"></div>
                            <span>Á¥´</span>
                        </div>
                    </div>
                </div>
            </div>
            <input type="text" class="todo-input" id="todoInput" placeholder="Êñ∞„Åó„ÅÑTodo„ÇíÂÖ•Âäõ..." maxlength="500">
            <button class="add-btn" id="addBtn">+</button>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3>Á¢∫Ë™ç</h3>
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="confirmCancel">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn-danger" id="confirmOk">ÂÆüË°å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="helpModal">
        <div class="modal-content">
            <h3>‰Ωø„ÅÑÊñπ„Ç¨„Ç§„Éâ</h3>
            <div class="help-content">
                <div class="help-section">
                    <h4><i class="mdi mdi-note-plus"></i> ‰ªòÁÆã„ÅÆ‰ΩúÊàê</h4>
                    <p>‚Ä¢ ‰∏ãÈÉ®„ÅÆÂÖ•Âäõ„Éï„Ç©„Éº„É†„Å´„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶Enter„Ç≠„Éº„Åæ„Åü„ÅØ+„Éú„Çø„É≥„ÇíÊäº„Åô</p>
                    <p>‚Ä¢ „É°„Éã„É•„Éº„Åã„Çâ„ÄåÁ©∫„ÅÆ‰ªòÁÆãËøΩÂä†„Äç„ÇíÈÅ∏Êäû</p>
                </div>
                <div class="help-section">
                    <h4><i class="mdi mdi-pencil"></i> ‰ªòÁÆã„ÅÆÁ∑®ÈõÜ</h4>
                    <p>‚Ä¢ ‰ªòÁÆã„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶Ëá™Áî±„Å´ÁßªÂãï</p>
                    <p>‚Ä¢ ‰ªòÁÆãÂÜÖ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Á∑®ÈõÜ</p>
                    <p>‚Ä¢ <i class="mdi mdi-palette"></i>„Éú„Çø„É≥„ÅßËâ≤„ÇíÂ§âÊõ¥</p>
                    <p>‚Ä¢ <i class="mdi mdi-delete"></i>„Éú„Çø„É≥„ÅßÂâäÈô§</p>
                </div>
                <div class="help-section">
                    <h4><i class="mdi mdi-cog"></i> Ë®≠ÂÆö„Å®„Ç´„Çπ„Çø„Éû„Ç§„Ç∫</h4>
                    <p>‚Ä¢ „Çµ„Ç§„Ç∫„Éî„ÉÉ„Ç´„Éº„Åß‰ªòÁÆã„ÅÆ„Çµ„Ç§„Ç∫„ÇíÈÅ∏Êäû</p>
                    <p>‚Ä¢ „Ç´„É©„Éº„Éî„ÉÉ„Ç´„Éº„ÅßÊñ∞„Åó„ÅÑ‰ªòÁÆã„ÅÆËâ≤„ÇíÈÅ∏Êäû</p>
                    <p>‚Ä¢ <i class="mdi mdi-shuffle-variant"></i>„É©„É≥„ÉÄ„É†ÈÖçÁΩÆ„Åß‰ªòÁÆã„Çí„É©„É≥„ÉÄ„É†ÈÖçÁΩÆ</p>
                </div>
                <div class="help-section">
                    <h4><i class="mdi mdi-content-save"></i> „Éá„Éº„ÇøÁÆ°ÁêÜ</h4>
                    <p>‚Ä¢ Ëá™Âãï‰øùÂ≠òÊ©üËÉΩ„Åß„Éá„Éº„Çø„ÇíÂ∏∏ÊôÇ‰øùÂ≠ò</p>
                    <p>‚Ä¢ <i class="mdi mdi-export"></i>„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åß„Éá„Éº„Çø„Çí„Éï„Ç°„Ç§„É´„Å´‰øùÂ≠ò</p>
                    <p>‚Ä¢ <i class="mdi mdi-import"></i>„Ç§„É≥„Éù„Éº„Éà„Åß„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø</p>
                    <p>‚Ä¢ Ë®≠ÂÆö„ÅßËá™Âãï‰øùÂ≠òÈñìÈöî„ÇíË™øÊï¥</p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="helpClose">Èñâ„Åò„Çã</button>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h3>Ë®≠ÂÆö</h3>
            <div class="settings-item">
                <span>Ëá™Âãï‰øùÂ≠ò</span>
                <div class="switch on" id="autoSaveSwitch">
                    <div class="switch-thumb"></div>
                </div>
            </div>
            <div class="settings-item">
                <span>‰øùÂ≠òÈñìÈöîÔºàmsÔºâ</span>
                <input type="number" value="500" min="100" max="5000" step="100" id="saveInterval" style="width: 80px; padding: 5px;">
            </div>
            <div class="settings-item">
                <span>„Éá„Éº„Çø„ÇØ„É™„Ç¢</span>
                <button class="btn btn-danger" id="clearData">ÂÖ®„Éá„Éº„ÇøÂâäÈô§</button>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="settingsClose">Èñâ„Åò„Çã</button>
            </div>
        </div>
    </div>

    <input type="file" class="file-input" id="fileInput" accept=".json">

    <script>
        class StickyNotesApp {
            constructor() {
                this.notes = [];
                this.nextId = 1;
                this.currentSize = 'medium';
                this.currentColor = 'yellow';
                this.isDragging = false;
                this.dragOffset = { x: 0, y: 0 };
                this.autoSave = true;
                this.saveInterval = 500;
                this.saveTimeout = null;
                this.storageKey = 'stickyNotesApp';
                
                this.initializeElements();
                this.bindEvents();
                this.loadData();
                this.updateStatus();
            }

            initializeElements() {
                this.workspace = document.getElementById('workspace');
                this.todoInput = document.getElementById('todoInput');
                this.addBtn = document.getElementById('addBtn');
                this.sizePicker = document.getElementById('sizePicker');
                this.sizeDropdown = document.getElementById('sizeDropdown');
                this.colorPicker = document.getElementById('colorPicker');
                this.colorDropdown = document.getElementById('colorDropdown');
                this.menuButton = document.getElementById('menuButton');
                this.menuDropdown = document.getElementById('menuDropdown');
                this.statusIndicator = document.getElementById('statusIndicator');
                this.statusText = document.getElementById('statusText');
                this.noteCount = document.getElementById('noteCount');
                this.fileInput = document.getElementById('fileInput');
            }

            bindEvents() {
                // Âü∫Êú¨ÁöÑ„Å™„Ç§„Éô„É≥„Éà
                this.addBtn.addEventListener('click', () => this.addNote());
                this.todoInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addNote();
                });

                // „Éî„ÉÉ„Ç´„Éº„Ç§„Éô„É≥„Éà
                this.sizePicker.addEventListener('click', () => this.toggleDropdown('size'));
                this.colorPicker.addEventListener('click', () => this.toggleDropdown('color'));

                // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Ç§„Éô„É≥„Éà
                this.sizeDropdown.addEventListener('click', (e) => {
                    const item = e.target.closest('.dropdown-item');
                    if (item) {
                        this.currentSize = item.dataset.size;
                        this.updateSizePicker();
                        this.hideDropdown('size');
                    }
                });

                this.colorDropdown.addEventListener('click', (e) => {
                    const item = e.target.closest('.dropdown-item');
                    if (item) {
                        this.currentColor = item.dataset.color;
                        this.updateColorPicker();
                        this.hideDropdown('color');
                    }
                });

                // „É°„Éã„É•„Éº„Ç§„Éô„É≥„Éà
                this.menuButton.addEventListener('click', () => this.toggleMenu());
                
                // „É°„Éã„É•„Éº„Ç¢„Ç§„ÉÜ„É†„Ç§„Éô„É≥„Éà
                document.getElementById('menuAddNote').addEventListener('click', () => this.addEmptyNote());
                document.getElementById('menuDeleteAll').addEventListener('click', () => this.deleteAllNotes());
                document.getElementById('menuRandomize').addEventListener('click', () => this.randomizeNotes());
                document.getElementById('menuHelp').addEventListener('click', () => this.showHelp());
                document.getElementById('menuSave').addEventListener('click', () => this.manualSave());
                document.getElementById('menuExport').addEventListener('click', () => this.exportData());
                document.getElementById('menuImport').addEventListener('click', () => this.importData());
                document.getElementById('menuSettings').addEventListener('click', () => this.showSettings());

                // „É¢„Éº„ÉÄ„É´„Ç§„Éô„É≥„Éà
                document.getElementById('confirmCancel').addEventListener('click', () => this.hideModal('confirmModal'));
                document.getElementById('confirmOk').addEventListener('click', () => this.confirmAction());
                document.getElementById('helpClose').addEventListener('click', () => this.hideModal('helpModal'));
                document.getElementById('settingsClose').addEventListener('click', () => this.hideModal('settingsModal'));

                // Ë®≠ÂÆö„Ç§„Éô„É≥„Éà
                document.getElementById('autoSaveSwitch').addEventListener('click', () => this.toggleAutoSave());
                document.getElementById('saveInterval').addEventListener('change', (e) => {
                    this.saveInterval = parseInt(e.target.value);
                });
                document.getElementById('clearData').addEventListener('click', () => this.clearAllData());

                // „Éï„Ç°„Ç§„É´ÂÖ•Âäõ„Ç§„Éô„É≥„Éà
                this.fileInput.addEventListener('change', (e) => this.handleFileImport(e));

                // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„Åß„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„Çã
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.picker')) {
                        this.hideDropdown('size');
                        this.hideDropdown('color');
                    }
                    if (!e.target.closest('.menu-button') && !e.target.closest('.menu-dropdown')) {
                        this.hideMenu();
                    }
                });

                // „Éâ„É©„ÉÉ„Ç∞„Ç§„Éô„É≥„Éà
                document.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                document.addEventListener('mouseup', () => this.handleMouseUp());
            }

            addNote() {
                const text = this.todoInput.value.trim();
                if (!text) return;

                const note = this.createNote(text);
                this.notes.push(note);
                this.renderNote(note);
                this.todoInput.value = '';
                this.todoInput.focus();
                this.autoSaveData();
            }

            addEmptyNote() {
                const note = this.createNote('');
                this.notes.push(note);
                this.renderNote(note);
                this.hideMenu();
                // Á©∫„ÅÆ‰ªòÁÆã‰ΩúÊàêÂæå„Åô„Åê„Å´„Éï„Ç©„Éº„Ç´„Çπ
                setTimeout(() => {
                    const noteElement = document.querySelector(`[data-id="${note.id}"] .note-content`);
                    if (noteElement) noteElement.focus();
                }, 100);
                this.autoSaveData();
            }

            createNote(text) {
                const workspace = this.workspace.getBoundingClientRect();
                const x = Math.random() * (workspace.width - 250);
                const y = Math.random() * (workspace.height - 220);
                
                return {
                    id: this.nextId++,
                    text: text,
                    color: this.currentColor,
                    size: this.currentSize,
                    x: x,
                    y: y,
                    date: new Date().toLocaleString('ja-JP'),
                    lastModified: new Date().toLocaleString('ja-JP')
                };
            }

            renderNote(note) {
                const noteElement = document.createElement('div');
                noteElement.className = `sticky-note ${note.color} ${note.size}`;
                noteElement.dataset.id = note.id;
                noteElement.style.left = note.x + 'px';
                noteElement.style.top = note.y + 'px';
                noteElement.style.transform = `rotate(${Math.random() * 6 - 3}deg)`;

                noteElement.innerHTML = `
                    <div class="note-header">
                        <span></span>
                        <div class="note-actions">
                            <button class="note-btn color-btn" title="Ëâ≤„ÇíÂ§âÊõ¥"><i class="mdi mdi-palette"></i></button>
                            <button class="note-btn delete-btn" title="ÂâäÈô§"><i class="mdi mdi-delete"></i></button>
                        </div>
                    </div>
                    <textarea class="note-content" placeholder="„Åì„Åì„Å´ÂÖ•Âäõ...">${note.text}</textarea>
                    <div class="note-date">${note.date}</div>
                    <div class="color-picker">
                        <div class="color-option" style="background: #ffeb3b;" data-color="yellow"></div>
                        <div class="color-option" style="background: #f8bbd9;" data-color="pink"></div>
                        <div class="color-option" style="background: #90caf9;" data-color="blue"></div>
                        <div class="color-option" style="background: #a5d6a7;" data-color="green"></div>
                        <div class="color-option" style="background: #ffcc80;" data-color="orange"></div>
                        <div class="color-option" style="background: #ce93d8;" data-color="purple"></div>
                    </div>
                `;

                this.bindNoteEvents(noteElement, note);
                this.workspace.appendChild(noteElement);
                this.updateStatus();
            }

            bindNoteEvents(element, note) {
                const header = element.querySelector('.note-header');
                const content = element.querySelector('.note-content');
                const colorBtn = element.querySelector('.color-btn');
                const deleteBtn = element.querySelector('.delete-btn');
                const colorPicker = element.querySelector('.color-picker');

                // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßã
                header.addEventListener('mousedown', (e) => this.startDrag(e, element, note));

                // „ÉÜ„Ç≠„Çπ„ÉàÁ∑®ÈõÜ
                content.addEventListener('input', () => {
                    note.text = content.value;
                    note.lastModified = new Date().toLocaleString('ja-JP');
                    this.autoSaveData();
                });

                content.addEventListener('focus', () => {
                    element.classList.add('focused');
                });

                content.addEventListener('blur', () => {
                    element.classList.remove('focused');
                });

                // Ëâ≤Â§âÊõ¥
                colorBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    colorPicker.classList.toggle('show');
                });

                colorPicker.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const option = e.target.closest('.color-option');
                    if (option) {
                        const newColor = option.dataset.color;
                        this.changeNoteColor(element, note, newColor);
                        colorPicker.classList.remove('show');
                    }
                });

                // ÂâäÈô§
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.deleteNote(element, note);
                });

                // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„ÅßËâ≤ÈÅ∏Êäû„ÇíÈñâ„Åò„Çã
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.color-picker') && !e.target.closest('.color-btn')) {
                        colorPicker.classList.remove('show');
                    }
                });
            }

            startDrag(e, element, note) {
                if (e.target.closest('.note-actions') || e.target.closest('.note-content')) return;

                this.isDragging = true;
                this.currentDragElement = element;
                this.currentDragNote = note;
                
                const rect = element.getBoundingClientRect();
                this.dragOffset.x = e.clientX - rect.left;
                this.dragOffset.y = e.clientY - rect.top;
                
                element.classList.add('dragging');
                document.body.style.cursor = 'grabbing';
            }

            handleMouseMove(e) {
                if (!this.isDragging) return;

                const workspace = this.workspace.getBoundingClientRect();
                const element = this.currentDragElement;
                const note = this.currentDragNote;
                
                let x = e.clientX - workspace.left - this.dragOffset.x;
                let y = e.clientY - workspace.top - this.dragOffset.y;
                
                // ÁîªÈù¢Â§ñÂà∂Èôê
                x = Math.max(0, Math.min(x, workspace.width - element.offsetWidth));
                y = Math.max(0, Math.min(y, workspace.height - element.offsetHeight));
                
                element.style.left = x + 'px';
                element.style.top = y + 'px';
                
                note.x = x;
                note.y = y;
            }

            handleMouseUp() {
                if (!this.isDragging) return;

                this.isDragging = false;
                this.currentDragElement.classList.remove('dragging');
                document.body.style.cursor = 'default';
                
                this.currentDragNote.lastModified = new Date().toLocaleString('ja-JP');
                this.autoSaveData();
                
                this.currentDragElement = null;
                this.currentDragNote = null;
            }

            changeNoteColor(element, note, color) {
                element.className = `sticky-note ${color} ${note.size}`;
                note.color = color;
                note.lastModified = new Date().toLocaleString('ja-JP');
                this.autoSaveData();
            }

            deleteNote(element, note) {
                element.classList.add('deleting');
                setTimeout(() => {
                    element.remove();
                    const index = this.notes.findIndex(n => n.id === note.id);
                    if (index > -1) this.notes.splice(index, 1);
                    this.updateStatus();
                    this.autoSaveData();
                }, 500);
            }

            deleteAllNotes() {
                if (this.notes.length === 0) {
                    this.hideMenu();
                    return;
                }

                this.showConfirmModal('ÂÖ®„Å¶„ÅÆ‰ªòÁÆã„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü', () => {
                    const noteElements = document.querySelectorAll('.sticky-note');
                    
                    // „É©„É≥„ÉÄ„É†„Åß„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çø„Ç§„Éó„ÇíÈÅ∏Êäû
                    const animationTypes = [
                        'spin-fall',    // 720Â∫¶ÂõûËª¢ËêΩ‰∏ã
                        'normal-fall',  // ÊôÆÈÄö„Å´ËêΩ‰∏ã
                        'fade-out',     // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
                        'trash-suck',   // „Ç¥„ÉüÁÆ±„Å´Âê∏„ÅÑËæº„Åø
                        'walk-away'     // Ë∂≥„ÅåÁîü„Åà„Å¶ÈÄÉ„Åí„Çã
                    ];
                    
                    const selectedAnimation = animationTypes[Math.floor(Math.random() * animationTypes.length)];
                    console.log(`Selected animation: ${selectedAnimation}`);
                    
                    // „Ç¥„ÉüÁÆ±„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅ„Ç¥„ÉüÁÆ±„ÇíË°®Á§∫
                    if (selectedAnimation === 'trash-suck') {
                        this.showTrashCan();
                    }
                    
                    // ÂêÑ‰ªòÁÆã„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÈÅ©Áî®
                    noteElements.forEach((element, index) => {
                        // ÁèæÂú®„ÅÆÂõûËª¢ËßíÂ∫¶„ÇíÂèñÂæó
                        const currentTransform = getComputedStyle(element).transform;
                        const currentRotation = this.getRotationFromMatrix(currentTransform);
                        element.style.setProperty('--initial-rotation', `${currentRotation}deg`);
                        
                        // Ê≠©Ë°å„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅÊñπÂêë„ÇíË®≠ÂÆö
                        if (selectedAnimation === 'walk-away') {
                            const walkDirection = Math.random() > 0.5 ? 1 : -1;
                            element.style.setProperty('--walk-direction', `${walkDirection * 100}px`);
                            element.classList.add('walking');
                        }
                        
                        // „Ç¥„ÉüÁÆ±„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅ„Ç¥„ÉüÁÆ±„ÅÆ‰ΩçÁΩÆ„ÇíË®≠ÂÆö
                        if (selectedAnimation === 'trash-suck') {
                            const trashCan = document.querySelector('.trash-can');
                            const trashRect = trashCan.getBoundingClientRect();
                            const noteRect = element.getBoundingClientRect();
                            
                            const deltaX = trashRect.left - noteRect.left;
                            const deltaY = trashRect.top - noteRect.top;
                            
                            element.style.setProperty('--trash-x', `${deltaX}px`);
                            element.style.setProperty('--trash-y', `${deltaY}px`);
                        }
                        
                        setTimeout(() => {
                            element.classList.add('falling', selectedAnimation);
                            
                            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊôÇÈñì„ÇíË®≠ÂÆö
                            const animationDuration = {
                                'spin-fall': 2000,
                                'normal-fall': 1500,
                                'fade-out': 1000,
                                'trash-suck': 1500,
                                'walk-away': 2000
                            };
                            
                            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´Ë¶ÅÁ¥†„ÇíÂâäÈô§
                            setTimeout(() => {
                                if (element.parentNode) {
                                    element.remove();
                                }
                            }, animationDuration[selectedAnimation]);
                        }, index * 100); // 100ms„Åö„Å§ÈÅÖÂª∂
                    });
                    
                    // „Ç¥„ÉüÁÆ±„ÇíÈö†„Åô
                    if (selectedAnimation === 'trash-suck') {
                        setTimeout(() => {
                            this.hideTrashCan();
                        }, 3000);
                    }
                    
                    // „Éá„Éº„Çø„ÇíÂç≥Â∫ß„Å´„ÇØ„É™„Ç¢
                    this.notes = [];
                    
                    // UIÊõ¥Êñ∞
                    setTimeout(() => {
                        this.updateStatus();
                        this.autoSaveData();
                    }, 200);
                });
                this.hideMenu();
            }

            showTrashCan() {
                let trashCan = document.querySelector('.trash-can');
                if (!trashCan) {
                    trashCan = document.createElement('div');
                    trashCan.className = 'trash-can';
                    document.body.appendChild(trashCan);
                }
                
                // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Åã„ÇâË°®Á§∫
                setTimeout(() => {
                    trashCan.classList.add('show');
                }, 100);
            }

            hideTrashCan() {
                const trashCan = document.querySelector('.trash-can');
                if (trashCan) {
                    trashCan.classList.remove('show');
                    setTimeout(() => {
                        if (trashCan.parentNode) {
                            trashCan.remove();
                        }
                    }, 300);
                }
            }

            // TransformË°åÂàó„Åã„ÇâÂõûËª¢ËßíÂ∫¶„ÇíÊäΩÂá∫„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
            getRotationFromMatrix(transform) {
                if (transform === 'none') return 0;
                
                const values = transform.split('(')[1].split(')')[0].split(',');
                const a = values[0];
                const b = values[1];
                const angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
                return angle;
            }

            randomizeNotes() {
                if (this.notes.length === 0) {
                    this.hideMenu();
                    return;
                }

                const workspace = this.workspace.getBoundingClientRect();
                
                this.notes.forEach(note => {
                    const element = document.querySelector(`[data-id="${note.id}"]`);
                    if (element) {
                        const x = Math.random() * (workspace.width - element.offsetWidth);
                        const y = Math.random() * (workspace.height - element.offsetHeight);
                        
                        element.style.transition = 'all 0.5s ease';
                        element.style.left = x + 'px';
                        element.style.top = y + 'px';
                        element.style.transform = `rotate(${Math.random() * 6 - 3}deg)`;
                        
                        note.x = x;
                        note.y = y;
                        note.lastModified = new Date().toLocaleString('ja-JP');
                        
                        setTimeout(() => {
                            element.style.transition = '';
                        }, 500);
                    }
                });
                
                this.hideMenu();
                this.autoSaveData();
            }

            toggleDropdown(type) {
                const dropdown = document.getElementById(`${type}Dropdown`);
                dropdown.classList.toggle('show');
            }

            hideDropdown(type) {
                const dropdown = document.getElementById(`${type}Dropdown`);
                dropdown.classList.remove('show');
            }

            updateSizePicker() {
                const sizeNames = { small: 'Â∞è', medium: '‰∏≠', large: 'Â§ß' };
                this.sizePicker.innerHTML = `
                    <div class="size-indicator ${this.currentSize}"></div>
                    <span>${sizeNames[this.currentSize]}</span>
                `;
            }

            updateColorPicker() {
                const colorNames = { 
                    yellow: 'ÈªÑ', pink: '„Éî„É≥„ÇØ', blue: 'Èùí', 
                    green: 'Á∑ë', orange: '„Ç™„É¨„É≥„Ç∏', purple: 'Á¥´' 
                };
                const colorValues = {
                    yellow: '#ffeb3b', pink: '#f8bbd9', blue: '#90caf9',
                    green: '#a5d6a7', orange: '#ffcc80', purple: '#ce93d8'
                };
                
                this.colorPicker.innerHTML = `
                    <div class="color-dot" style="background: ${colorValues[this.currentColor]};"></div>
                    <span>${colorNames[this.currentColor]}</span>
                `;
            }

            toggleMenu() {
                this.menuDropdown.classList.toggle('show');
            }

            hideMenu() {
                this.menuDropdown.classList.remove('show');
            }

            showHelp() {
                this.showModal('helpModal');
                this.hideMenu();
            }

            showSettings() {
                this.showModal('settingsModal');
                this.hideMenu();
            }

            manualSave() {
                this.saveData();
                this.updateStatus('saved');
                this.hideMenu();
            }

            exportData() {
                const data = {
                    notes: this.notes,
                    settings: {
                        globalSize: this.currentSize,
                        globalColor: this.currentColor,
                        autoSave: this.autoSave,
                        saveInterval: this.saveInterval,
                        lastSaveTime: new Date().toLocaleString('ja-JP')
                    }
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sticky-notes-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.hideMenu();
            }

            showConfirmModal(message, onConfirm) {
                document.getElementById('confirmMessage').textContent = message;
                this.showModal('confirmModal');
                this.confirmCallback = onConfirm;
            }

            confirmAction() {
                if (this.confirmCallback) {
                    this.confirmCallback();
                    this.confirmCallback = null;
                }
                this.hideModal('confirmModal');
            }

            showModal(modalId) {
                document.getElementById(modalId).classList.add('show');
            }

            hideModal(modalId) {
                document.getElementById(modalId).classList.remove('show');
            }

            toggleAutoSave() {
                this.autoSave = !this.autoSave;
                const switchElement = document.getElementById('autoSaveSwitch');
                switchElement.classList.toggle('on', this.autoSave);
                this.saveData(); // Ë®≠ÂÆö„Çí‰øùÂ≠ò
            }

            clearAllData() {
                this.showConfirmModal('ÂÖ®„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ', () => {
                    const noteElements = document.querySelectorAll('.sticky-note');
                    noteElements.forEach(element => element.remove());
                    this.notes = [];
                    this.nextId = 1;
                    
                    // localStorage„Åã„Çâ„ÇÇÂâäÈô§
                    try {
                        if (typeof(Storage) !== "undefined" && localStorage) {
                            localStorage.removeItem(this.storageKey);
                        }
                        if (this.savedData) {
                            delete this.savedData;
                        }
                    } catch (error) {
                        console.error('Clear storage error:', error);
                    }
                    
                    this.updateStatus();
                    this.hideModal('settingsModal');
                });
            }

            autoSaveData() {
                if (!this.autoSave) return;

                if (this.saveTimeout) {
                    clearTimeout(this.saveTimeout);
                }

                this.updateStatus('saving');
                
                this.saveTimeout = setTimeout(() => {
                    this.saveData();
                    this.updateStatus('saved');
                }, this.saveInterval);
            }

            saveData() {
                const data = {
                    notes: this.notes,
                    settings: {
                        globalSize: this.currentSize,
                        globalColor: this.currentColor,
                        autoSave: this.autoSave,
                        saveInterval: this.saveInterval,
                        nextId: this.nextId,
                        lastSaveTime: new Date().toLocaleString('ja-JP')
                    }
                };

                try {
                    if (typeof(Storage) !== "undefined" && localStorage) {
                        localStorage.setItem(this.storageKey, JSON.stringify(data));
                        console.log('Data saved to localStorage');
                    } else {
                        // localStorage „Åå‰ΩøÁî®„Åß„Åç„Å™„ÅÑÂ†¥ÂêàÔºàClaude.aiÁí∞Â¢É„Å™„Å©Ôºâ
                        this.savedData = data;
                        console.log('Data saved to memory (localStorage not available)');
                    }
                } catch (error) {
                    console.error('Save error:', error);
                    this.updateStatus('error');
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „É°„É¢„É™ÂÜÖ‰øùÂ≠ò
                    this.savedData = data;
                }
            }

            loadData() {
                try {
                    if (typeof(Storage) !== "undefined" && localStorage) {
                        const savedData = localStorage.getItem(this.storageKey);
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            this.restoreFromData(data);
                            console.log('Data loaded from localStorage');
                            return;
                        }
                    }
                    
                    // localStorage „Åå‰ΩøÁî®„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÄÅ„É°„É¢„É™„Åã„ÇâË™≠„ÅøËæº„Åø
                    if (this.savedData) {
                        this.restoreFromData(this.savedData);
                        console.log('Data loaded from memory');
                    }
                } catch (error) {
                    console.error('Load error:', error);
                    this.updateStatus('error');
                }
            }

            restoreFromData(data) {
                if (data.notes && Array.isArray(data.notes)) {
                    this.notes = data.notes;
                    this.notes.forEach(note => {
                        this.renderNote(note);
                    });
                }

                if (data.settings) {
                    this.currentSize = data.settings.globalSize || 'medium';
                    this.currentColor = data.settings.globalColor || 'yellow';
                    this.autoSave = data.settings.autoSave !== false;
                    this.saveInterval = data.settings.saveInterval || 500;
                    this.nextId = data.settings.nextId || Math.max(...this.notes.map(n => n.id), 0) + 1;

                    // UIË¶ÅÁ¥†„ÇíÊõ¥Êñ∞
                    this.updateSizePicker();
                    this.updateColorPicker();
                    
                    const autoSaveSwitch = document.getElementById('autoSaveSwitch');
                    const saveIntervalInput = document.getElementById('saveInterval');
                    if (autoSaveSwitch) autoSaveSwitch.classList.toggle('on', this.autoSave);
                    if (saveIntervalInput) saveIntervalInput.value = this.saveInterval;
                }

                this.updateStatus('loaded');
            }

            clearAllData() {
                this.showConfirmModal('ÂÖ®„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ', () => {
                    const noteElements = document.querySelectorAll('.sticky-note');
                    noteElements.forEach(element => element.remove());
                    this.notes = [];
                    this.nextId = 1;
                    
                    // localStorage„Åã„Çâ„ÇÇÂâäÈô§
                    try {
                        if (typeof(Storage) !== "undefined" && localStorage) {
                            localStorage.removeItem(this.storageKey);
                        }
                        if (this.savedData) {
                            delete this.savedData;
                        }
                    } catch (error) {
                        console.error('Clear storage error:', error);
                    }
                    
                    this.updateStatus();
                    this.hideModal('settingsModal');
                });
            }

            handleFileImport(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.notes && Array.isArray(data.notes)) {
                            // Êó¢Â≠ò„ÅÆ‰ªòÁÆã„ÇíÂâäÈô§
                            document.querySelectorAll('.sticky-note').forEach(el => el.remove());
                            
                            // Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
                            this.restoreFromData(data);
                            
                            // „Ç§„É≥„Éù„Éº„ÉàÂæå„Å´localStorage„Å´‰øùÂ≠ò
                            this.saveData();
                            this.updateStatus('imported');
                        } else {
                            throw new Error('ÁÑ°Âäπ„Å™„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„Åß„Åô');
                        }
                    } catch (error) {
                        alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                        this.updateStatus('error');
                    }
                };
                
                reader.readAsText(file);
                event.target.value = '';
            }

            updateStatus(status = 'saved') {
                const statusTexts = {
                    saved: '‰øùÂ≠òÊ∏à„Åø',
                    saving: '‰øùÂ≠ò‰∏≠...',
                    loaded: 'Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü',
                    imported: '„Ç§„É≥„Éù„Éº„ÉàÂÆå‰∫Ü',
                    error: '‰øùÂ≠ò„Ç®„É©„Éº'
                };
                
                const statusColors = {
                    saved: '#4CAF50',
                    saving: '#FF9800',
                    loaded: '#2196F3',
                    imported: '#2196F3',
                    error: '#f44336'
                };
                
                this.statusText.textContent = statusTexts[status];
                this.statusIndicator.style.background = statusColors[status];
                this.noteCount.textContent = `${this.notes.length}ÂÄã„ÅÆ‰ªòÁÆã`;
            }
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            new StickyNotesApp();
        });
    </script>
</body>
</html>