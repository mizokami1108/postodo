# 付箋 Todo アプリ 保存機能仕様書

## 💾 保存機能概要

ブラウザの localStorage を使用した永続化機能により、アプリ終了後もデータを保持

## 🗃️ データ構造

### 保存対象データ

```javascript
{
  notes: [
    {
      id: 1,
      text: "付箋の内容",
      color: "yellow",
      size: "medium",
      x: 100,
      y: 200,
      date: "2025/7/17 14:30:00",
      lastModified: "2025/7/17 15:45:00"
    }
  ],
  settings: {
    globalSize: "medium",
    globalColor: "yellow",
    lastSaveTime: "2025/7/17 15:45:00"
  }
}
```

## ⚡ 自動保存機能

### トリガー

- 付箋作成時
- テキスト変更時（500ms 遅延での自動保存）
- 付箋移動完了時
- 付箋削除時
- 色・サイズ変更時
- 全削除実行時

### 保存間隔

- **リアルタイム**: 作成・削除・色変更
- **遅延保存**: テキスト入力（500ms 後）
- **即座保存**: 移動完了時

## 🔄 復元機能

### 起動時復元

- ページロード時に自動的に localStorage から読み込み
- 保存された位置・内容・属性で付箋を再現
- グローバル設定（サイズ・カラー選択）も復元

### データ検証

- 不正なデータの除外
- 画面外位置の自動補正
- 存在しない色・サイズの初期値設定

## 💽 手動保存・管理機能

### FAB メニュー拡張

5. **💾 手動保存** (270 度・左上方向) - 現在の状態を明示的に保存
6. **📤 エクスポート** (300 度・左方向) - JSON 形式でダウンロード
7. **📥 インポート** (330 度・左下方向) - ファイルからデータ読み込み

### エクスポート機能

- **形式**: JSON 形式
- **ファイル名**: `sticky-notes-YYYY-MM-DD.json`
- **内容**: 全付箋データ + 設定情報
- **ダウンロード**: ブラウザのダウンロード機能使用

### インポート機能

- **対応形式**: JSON 形式
- **マージ方式**: 既存データに追加 or 置換選択
- **重複回避**: 新しい ID を自動採番
- **エラーハンドリング**: 不正ファイル警告

## 📊 保存状態表示

### ステータス表示

- **位置**: ヘッダー右端
- **表示内容**:
  - 💾 保存済み (緑)
  - ⏳ 保存中 (黄)
  - ❌ 保存エラー (赤)
  - 📴 オフライン (グレー)

### 詳細情報

- 最終保存時刻
- 保存済み付箋数
- ストレージ使用量

## 🔧 保存設定・オプション

### 設定メニュー (FAB メニュー内)

8. **⚙️ 設定** - 保存関連オプション

### 設定項目

- **自動保存**: ON/OFF 切り替え
- **保存間隔**: テキスト入力後の遅延時間設定
- **バックアップ**: 定期的な自動エクスポート
- **データクリア**: 全保存データの削除

## 🚨 エラーハンドリング

### 保存エラー対応

- **容量不足**: 古いデータの自動削除提案
- **権限エラー**: プライベートモード警告
- **データ破損**: バックアップからの復元提案

### 復旧機能

- **緊急バックアップ**: 毎日自動作成
- **復元ポイント**: 操作前状態への復帰
- **データ修復**: 破損データの自動修正

## 📱 オフライン対応

### オフライン機能

- **ローカル保存**: 常時ローカルストレージ使用
- **同期不要**: 単体完結型
- **オフライン表示**: ネットワーク状態の表示

## 🔄 データ移行・互換性

### バージョン管理

- **データ形式バージョン**: スキーマバージョン管理
- **下位互換**: 旧形式データの自動変換
- **アップデート**: 新機能追加時の移行処理

### ブラウザ間移行

- **エクスポート/インポート**: 手動でのデータ移行
- **設定同期**: 設定値の移行
- **一括移行**: 全データの一括移行

## 💡 使用ケース

### 日常利用

1. アプリ起動 → 前回の付箋が自動復元
2. 新しい付箋作成 → 自動保存
3. 付箋編集 → リアルタイム保存
4. アプリ終了 → 次回起動時に継続

### データ管理

1. 定期バックアップ → エクスポート機能
2. デバイス移行 → エクスポート → インポート
3. データ整理 → 設定からクリア

この保存機能により、付箋 Todo アプリが実用的な日常ツールとして継続利用できるようになります！
